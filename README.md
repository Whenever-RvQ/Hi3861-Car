# 基于Hi3861智能小车项目

## 一、模块划分及介绍

我们小组将智能小车划分为以下几个核心模块，各模块功能如下：

- **调速模块**：负责控制小车电机的转速，实现不同档位的速度调节，以适应不同地图难度和行驶场景的需求。
- **OLED屏幕渲染模块**：用于实时显示小车的行驶状态，包括当前方向、速度等信息，为用户提供直观的状态反馈。
- **硬件按钮控制模块**：通过实体按键实现对小车运行模式（循迹/遥控）、速度档位、地图难度的切换与选择，是人机交互的重要接口。
- **前端与MQTT交互模块**：基于Web前端技术开发遥控界面，通过MQTT协议实现前端与小车之间的消息通信，支持远程控制指令的发送与小车状态的接收。


## 二、实验过程

### 1. 组装与基础测试

- 首先根据说明书完成小车各模块的组装与连接，确保硬件电路连接正确。
- 对调速模块、传感器模块、通信模块等进行单独测试，验证各模块能否正常执行预设功能（如电机转动、传感器检测、消息收发等）。

### 2. 初步功能整合与问题发现

- 编写基础代码将各模块功能串联，形成简单的跑图程序。测试结果显示：
  - 小车能成功识别障碍物并执行停车操作。
  - 可识别黑线并完成转弯动作，但转弯效果不理想，尤其是在复杂弯道处表现较差。

### 3. 分工开发与功能实现

- **遥控小车开发**：
  - 选用Web前端技术，基于JavaScript开发遥控界面。
  - 先完成Web端逻辑编写，通过MQTT客户端测试确认主题订阅与消息发布功能正常。
  - 再开发小车端代码，实现对MQTT消息的解析与执行。

- **OLED屏显示与车速调节**：
  - 参考课程中OLED显示和PWM呼吸灯的案例，修改相关函数。
  - 实现OLED屏实时显示行驶方向、速度，以及通过PWM技术调节车速的功能。

### 4. 跑图能力优化

- 通过观察小车过弯（直角弯、锐角弯）和出线时的状态，重新设计转弯逻辑与停车逻辑。
- 多次调整转弯参数（如转向角度、电机转速差）、优化传感器位置，并尝试不同算法。
- 最终解决直角弯和锐角弯通过困难的问题，显著提升跑图稳定性。

### 5. 功能整合与逻辑完善

- 将各模块功能整合，通过三个硬件按键的设置，完善小车运行逻辑：
  - 支持速度档位选择。
  - 实现循迹模式与遥控模式的切换。
  - 可选择三种难度的地图，且针对不同地图自动匹配对应的转弯逻辑和停车逻辑。


## 三、相关结果

- **核心功能实现**：
  - 三档速度选择：满足不同场景下的速度需求。
  - 双模式运行：支持循迹模式（自动避障、黑线识别与转弯）和遥控模式（Web端远程控制）。
  - 多地图适配：成功通过三种难度的地图，且针对不同地图优化了行驶策略。

- **遥控模式细节**：
  - Web前端界面简洁美观，包含MQTT连接状态显示、方向控制按钮、速度调节滑块、小车状态实时反馈及消息记录区域。
  - 支持通过点击界面图标或键盘按键控制小车方向。

- **状态反馈**：
  - 在循迹模式和遥控模式下，OLED屏均能实时显示小车的行驶方向（如前进、左转、右转）和当前速度档位。
